-- | Generic class of errors generated by the minijuvix compiler. Inspired by
-- Control.Exception
module MiniJuvix.Prelude.Error where

import MiniJuvix.Prelude.Base

-- | Wrapper for any instance of JuvixError.
data AJuvixError = forall e. JuvixError e => AJuvixError e

-- | Minimal interface of an minijuvix error.
class Typeable e => JuvixError e where
   -- | Print the to stderr with Ansi formatting.
   printErrorAnsi :: e -> IO ()
   printErrorAnsi = hPutStrLn stderr . renderAnsiText

   -- | Print the to stderr without formatting.
   printErrorText :: e -> IO ()
   printErrorText = hPutStrLn stderr . renderText

   -- | Render the error to Text.
   renderText :: e -> Text

   -- | Render the error with Ansi formatting (if any).
   renderAnsiText :: e -> Text
   renderAnsiText = renderText

toAJuvixError :: JuvixError e => e -> AJuvixError
toAJuvixError = AJuvixError

fromAJuvixError :: JuvixError e => AJuvixError -> Maybe e
fromAJuvixError (AJuvixError e) = cast e
